<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Performance Stats & Log Job - Speedpack Express</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Basic styling */
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .stats-section, .form-section {
      background: #fff;
      margin-bottom: 40px;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stats-section h1, .form-section h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .stats-box {
      background: #e8e8e8;
      padding: 20px;
      border-radius: 8px;
      width: 250px;
      text-align: center;
    }
    .stats-box h2 {
      margin-bottom: 10px;
    }
    .stats-box p {
      margin: 5px 0;
      font-weight: bold;
    }
    .form-section form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 500px;
      margin: 0 auto;
    }
    .form-section input,
    .form-section textarea,
    .form-section button {
      padding: 10px;
      font-size: 16px;
    }
    .form-section button {
      background: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Performance Stats Section -->
    <section class="stats-section">
      <h1>Performance Stats</h1>
      <div class="stats-container">
        <!-- Each box has a unique ID based on its category.
             For example, "Tenders" becomes "tenders-box" and 
             "Airspace Tenders" becomes "airspace-tenders-box". -->
        <div class="stats-box" id="tenders-box">
          <h2>Tenders</h2>
          <p class="successful">Successful: 0</p>
          <p class="failed">Failed: 0</p>
        </div>
        <div class="stats-box" id="locals-box">
          <h2>Locals</h2>
          <p class="successful">Successful: 0</p>
          <p class="failed">Failed: 0</p>
        </div>
        <div class="stats-box" id="drives-box">
          <h2>Drives</h2>
          <p class="successful">Successful: 0</p>
          <p class="failed">Failed: 0</p>
        </div>
        <div class="stats-box" id="transfers-box">
          <h2>Transfers</h2>
          <p class="successful">Successful: 0</p>
          <p class="failed">Failed: 0</p>
        </div>
        <div class="stats-box" id="airspace-tenders-box">
          <h2>Airspace Tenders</h2>
          <p class="successful">Successful: 0</p>
          <p class="failed">Failed: 0</p>
        </div>
        <!-- Add more boxes as needed -->
      </div>
    </section>

    <!-- Log Job Form Section -->
    <section class="form-section">
      <h2>Log a Job</h2>
      <form id="logJobForm">
        <input type="text" name="jobNumber" placeholder="Job Number" required>
        <input type="text" name="dateTime" placeholder="Date & Time" required>
        <textarea name="status" placeholder="Status message (e.g., success or error message)" required></textarea>
        <input type="text" name="category" placeholder="Category (e.g., Tenders or Airspace Tenders)" required>
        <button type="submit">Log Job</button>
      </form>
    </section>
  </div>

  <script>
    // Set your backend URL (update if different)
    const backendURL = 'https://speedpack-express-website-backend.onrender.com';

    // Function to fetch and update performance stats from the backend
    function fetchPerformanceStats() {
      fetch(backendURL + '/api/performance-stats')
        .then(response => response.json())
        .then(data => {
          data.forEach(stat => {
            // Convert category to lowercase and replace spaces with dashes,
            // then append '-box' to match the HTML ID.
            const elementId = stat.category.toLowerCase().replace(/\s+/g, '-') + '-box';
            const box = document.getElementById(elementId);
            if (box) {
              box.querySelector('.successful').textContent = 'Successful: ' + stat.successful_uploads;
              box.querySelector('.failed').textContent = 'Failed: ' + stat.failed_uploads;
            }
          });
        })
        .catch(err => console.error('Error fetching performance stats:', err));
    }

    // Call fetchPerformanceStats when the page loads
    window.addEventListener('load', fetchPerformanceStats);

    // Handle Log Job form submission
    document.getElementById('logJobForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const jobData = {
        jobNumber: formData.get('jobNumber'),
        dateTime: formData.get('dateTime'),
        status: formData.get('status'),
        category: formData.get('category')
      };

      // Log the job by sending a POST request to the backend
      fetch(backendURL + '/api/log-job', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(jobData)
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message || data.error);
        // Refresh performance stats after logging a job
        fetchPerformanceStats();
        // Optionally reset the form
        e.target.reset();
      })
      .catch(err => console.error('Error logging job:', err));
    });
  </script>
</body>
</html>
